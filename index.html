<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <title>Pemilihan Organisasi SMAN 5 Bagan Sinembah</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Tambahkan CDN Supabase dengan fallback -->
    <script>
      // Flag untuk menandai apakah Supabase sudah dimuat
      window.supabaseLoaded = false;
      window.supabaseLoadError = false;
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.10/dist/umd/supabase.js"
      onload="
        window.supabaseLoaded = true;
        console.log('âœ… CDN Supabase berhasil dimuat (UMD)');
      "
      onerror="
        window.supabaseLoadError = true;
        console.warn('âš ï¸ CDN Supabase gagal dimuat - mode offline');
      "
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <!-- HEADER & NAVBAR -->
    <header>
      <div class="navbar">
        <div class="logo-container">
          <div class="logo">
            <img id="logo-image" src="" alt="Logo Sekolah" loading="lazy" />
          </div>
          <div class="logo-text">
            <h1 id="website-header">ğŸ—³ï¸ PEMILIHAN ORGANISASI</h1>
            <p id="school-info">SMAN 5 Bagan Sinembah | Periode 2026/2027</p>
          </div>
        </div>
        <div class="nav-links">
          <button id="btn-home" class="btn btn-primary">ğŸ  Beranda</button>
          <button id="btn-vote" class="btn btn-secondary">ğŸ—³ï¸ Voting</button>
          <button id="btn-results" class="btn btn-secondary">ğŸ“Š Hasil</button>
          <button id="btn-admin" class="btn btn-secondary">ğŸ‘¨â€ğŸ’¼ Admin</button>
        </div>
      </div>
    </header>

    <div class="container">
      <!-- HALAMAN BERANDA -->
      <div id="home-page" class="page active">
        <div class="card fade-in">
          <h2 style="color: var(--primary); margin-bottom: 20px">
            ğŸ¯ Selamat Datang di Sistem Pemilihan Online
          </h2>
          <p style="margin-bottom: 25px; font-size: 1.1rem">
            Pilih pemimpin terbaik untuk organisasi BEST, DPS, dan PMR SMAN 5
            Bagan Sinembah periode 2026/2027. Suara Anda menentukan masa depan
            organisasi!
          </p>

          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
              gap: 20px;
              margin-top: 30px;
            "
          >
            <div
              style="
                text-align: center;
                padding: 20px;
                background: linear-gradient(135deg, #9b59b6, #8e44ad);
                color: white;
                border-radius: 15px;
              "
            >
              <div style="font-size: 2.5rem; margin-bottom: 10px">ğŸ‘¥</div>
              <div
                style="font-size: 2rem; font-weight: bold"
                id="total-candidates"
              >
                0
              </div>
              <div>Total Paslon</div>
            </div>
            <div
              style="
                text-align: center;
                padding: 20px;
                background: linear-gradient(135deg, #3498db, #2980b9);
                color: white;
                border-radius: 15px;
              "
            >
              <div style="font-size: 2.5rem; margin-bottom: 10px">ğŸ—³ï¸</div>
              <div style="font-size: 2rem; font-weight: bold" id="total-votes">
                0
              </div>
              <div>Suara Masuk</div>
            </div>
            <div
              style="
                text-align: center;
                padding: 20px;
                background: linear-gradient(135deg, #2ecc71, #27ae60);
                color: white;
                border-radius: 15px;
              "
            >
              <div style="font-size: 2.5rem; margin-bottom: 10px">âœ…</div>
              <div
                style="font-size: 2rem; font-weight: bold"
                id="vote-percentage"
              >
                0%
              </div>
              <div>Partisipasi</div>
            </div>
          </div>
        </div>

        <!-- HASIL CEPAT -->
        <div class="card fade-in">
          <h3 style="color: var(--primary); margin-bottom: 20px">
            ğŸ“ˆ Hasil Pemilihan Terkini
          </h3>
          <div id="quick-results">
            <p>Memuat hasil...</p>
          </div>
        </div>

        <!-- ORGANISASI -->
        <div class="card fade-in">
          <h3 style="color: var(--primary); margin-bottom: 20px">
            ğŸ›ï¸ Organisasi yang Dipilih
          </h3>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
              gap: 20px;
            "
          >
            <div
              style="
                padding: 20px;
                background: rgba(155, 89, 182, 0.1);
                border-radius: 10px;
                border-left: 5px solid var(--purple);
              "
            >
              <h4 style="color: var(--purple); margin-bottom: 10px">ğŸ‘‘ BEST</h4>
              <p>
                Badan Ekstrakurikuler Siswa Terpadu - Mengelola semua kegiatan
                ekstrakurikuler sekolah.
              </p>
            </div>
            <div
              style="
                padding: 20px;
                background: rgba(230, 126, 34, 0.1);
                border-radius: 10px;
                border-left: 5px solid var(--orange);
              "
            >
              <h4 style="color: var(--orange); margin-bottom: 10px">âš–ï¸ DPS</h4>
              <p>
                Dewan Perwakilan Siswa - Mewakili aspirasi siswa dan mengawasi
                organisasi.
              </p>
            </div>
            <div
              style="
                padding: 20px;
                background: rgba(232, 67, 147, 0.1);
                border-radius: 10px;
                border-left: 5px solid var(--pink);
              "
            >
              <h4 style="color: var(--pink); margin-bottom: 10px">â¤ï¸ PMR</h4>
              <p>
                Palang Merah Remaja - Organisasi kesehatan dan kemanusiaan di
                sekolah.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- HALAMAN VOTING -->
      <div id="vote-page" class="page">
        <div class="card fade-in">
          <h2 style="color: var(--primary); margin-bottom: 20px">
            ğŸ—³ï¸ Formulir Pemilihan
          </h2>
          <p style="margin-bottom: 25px">
            Silakan lengkapi data diri Anda sebelum memberikan suara.
          </p>

          <!-- Data Pemilih -->
          <div class="form-group">
            <label for="voter-name">ğŸ‘¤ Nama Lengkap</label>
            <input
              type="text"
              id="voter-name"
              class="form-control"
              placeholder="Masukkan nama lengkap Anda"
              required
            />
          </div>

          <!-- Pilihan Kelas - FORMAT BARU -->
          <div class="form-group">
            <label>ğŸ« Pilih Kelas / Status</label>
            <div class="class-options" id="class-options">
              <!-- Kelas 10 -->
              <div class="class-option" data-value="10-1">10-1</div>
              <div class="class-option" data-value="10-2">10-2</div>
              <div class="class-option" data-value="10-3">10-3</div>
              <div class="class-option" data-value="10-4">10-4</div>
              <div class="class-option" data-value="10-5">10-5</div>

              <!-- Kelas 11 -->
              <div class="class-option" data-value="11-1">11-1</div>
              <div class="class-option" data-value="11-2">11-2</div>
              <div class="class-option" data-value="11-3">11-3</div>
              <div class="class-option" data-value="11-4">11-4</div>
              <div class="class-option" data-value="11-5">11-5</div>

              <!-- Kelas 12 -->
              <div class="class-option" data-value="12-1">12-1</div>
              <div class="class-option" data-value="12-2">12-2</div>
              <div class="class-option" data-value="12-3">12-3</div>
              <div class="class-option" data-value="12-4">12-4</div>
              <div class="class-option" data-value="12-5">12-5</div>

              <!-- Staf -->
              <div class="class-option" data-value="Guru">ğŸ‘¨â€ğŸ« Guru</div>
              <div class="class-option" data-value="Staff">ğŸ‘¨â€ğŸ’¼ Staff TU</div>
            </div>
            <input type="hidden" id="selected-class" required />
          </div>

          <!-- Step 2: Pemilihan Paslon -->
          <div id="paslon-selection-step">
            <h3 style="margin: 30px 0 20px 0; color: var(--primary)">
              ğŸ‘¥ Pilih Paslon Ketua & Wakil
            </h3>
            <p style="margin-bottom: 20px; color: var(--gray)">
              Pilih satu paslon untuk setiap organisasi:
            </p>

            <!-- Container untuk daftar paslon SEMUA organisasi -->
            <div id="paslon-container"></div>
          </div>

          <!-- Status Message -->
          <div id="vote-message" class="alert" style="display: none"></div>

          <!-- Tombol Kirim -->
          <div
            style="display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap"
          >
            <button
              id="btn-submit-vote"
              class="btn btn-success"
              style="flex: 1; display: none"
            >
              âœ… Kirim Semua Suara
            </button>
            <button id="btn-skip-vote" class="btn btn-warning" style="flex: 1">
              â­ï¸ Tidak Hadir
            </button>
            <button id="btn-back-vote" class="btn btn-secondary">
              â† Kembali ke Beranda
            </button>
          </div>
        </div>
      </div>

      <!-- HALAMAN HASIL -->
      <div id="results-page" class="page">
        <div class="card fade-in">
          <h2 style="color: var(--primary); margin-bottom: 20px">
            ğŸ“Š Hasil Pemilihan Lengkap
          </h2>

          <!-- Hasil -->
          <div id="results-container">
            <p>Memuat hasil pemilihan...</p>
          </div>

          <!-- Statistik -->
          <div
            style="
              background: var(--light);
              padding: 20px;
              border-radius: 10px;
              margin-top: 30px;
            "
          >
            <h4 style="margin-bottom: 15px">ğŸ“ˆ Statistik Pemilihan</h4>
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
              "
            >
              <div>
                <div
                  style="
                    font-size: 1.8rem;
                    font-weight: bold;
                    color: var(--primary);
                  "
                  id="results-total"
                >
                  0
                </div>
                <div>Total Suara</div>
              </div>
              <div>
                <div
                  style="
                    font-size: 1.8rem;
                    font-weight: bold;
                    color: var(--success);
                  "
                  id="results-valid"
                >
                  0
                </div>
                <div>Suara Sah</div>
              </div>
              <div>
                <div
                  style="
                    font-size: 1.8rem;
                    font-weight: bold;
                    color: var(--warning);
                  "
                  id="results-absent"
                >
                  0
                </div>
                <div>Tidak Hadir</div>
              </div>
            </div>
          </div>

          <div style="text-align: center; margin-top: 30px">
            <button id="btn-back-results" class="btn btn-primary">
              â† Kembali ke Beranda
            </button>
          </div>
        </div>
      </div>

      <!-- HALAMAN LOGIN ADMIN -->
      <div id="login-page" class="page">
        <div class="card fade-in" style="max-width: 400px; margin: 50px auto">
          <h2
            style="
              text-align: center;
              color: var(--primary);
              margin-bottom: 30px;
            "
          >
            ğŸ” Login Admin
          </h2>

          <div class="form-group">
            <label for="admin-password">ğŸ”’ Password Admin</label>
            <input
              type="password"
              id="admin-password"
              class="form-control"
              placeholder="Masukkan password admin"
            />
            <p style="font-size: 0.85rem; color: var(--gray); margin-top: 5px">
              Hubungi panitia untuk mendapatkan password
            </p>
          </div>

          <div id="login-message" class="alert" style="display: none"></div>

          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 15px;
              margin-top: 30px;
            "
          >
            <button id="btn-login" class="btn btn-primary">
              ğŸš€ Masuk ke Panel Admin
            </button>
            <button id="btn-back-login" class="btn btn-secondary">
              â† Kembali ke Beranda
            </button>
          </div>
        </div>
      </div>

      <!-- HALAMAN ADMIN -->
      <div id="admin-page" class="page">
        <div class="card fade-in">
          <h2 style="color: var(--primary); margin-bottom: 10px">
            âš™ï¸ Panel Administrator
          </h2>
          <p style="margin-bottom: 25px; color: var(--gray)">
            Kelola sistem pemilihan, paslon, dan hasil voting.
          </p>

          <!-- Tab Navigasi -->
          <div class="admin-nav">
            <button class="admin-tab active" data-tab="candidates">
              ğŸ‘¥ Kelola Paslon
            </button>
            <button class="admin-tab" data-tab="votes">ğŸ“‹ Data Suara</button>
            <button class="admin-tab" data-tab="results">
              ğŸ“Š Hasil Voting
            </button>
            <button class="admin-tab" data-tab="settings">âš™ï¸ Pengaturan</button>
          </div>

          <!-- Bagian Kelola Paslon -->
          <div id="admin-candidates" class="admin-section active">
            <h3 style="margin-bottom: 20px">ğŸ‘¥ Kelola Paslon Kandidat</h3>

            <!-- Form Tambah Paslon -->
            <div
              style="
                background: #f8f9fa;
                padding: 25px;
                border-radius: 15px;
                margin-bottom: 30px;
              "
            >
              <h4 style="margin-bottom: 20px">â• Tambah Paslon Baru</h4>

              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 20px;
                  margin-bottom: 20px;
                "
              >
                <div class="form-group">
                  <label>Organisasi</label>
                  <select id="new-candidate-org" class="form-control">
                    <option value="best">BEST</option>
                    <option value="dps">DPS</option>
                    <option value="pmr">PMR</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Status Paslon</label>
                  <select id="new-candidate-status" class="form-control">
                    <option value="active">Aktif</option>
                    <option value="inactive">Nonaktif</option>
                  </select>
                </div>
              </div>

              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 20px;
                  margin-bottom: 20px;
                "
              >
                <div class="form-group">
                  <label>Nama Ketua</label>
                  <input
                    type="text"
                    id="new-candidate-ketua"
                    class="form-control"
                    placeholder="Nama lengkap ketua"
                  />
                </div>
                <div class="form-group">
                  <label>Nama Wakil</label>
                  <input
                    type="text"
                    id="new-candidate-wakil"
                    class="form-control"
                    placeholder="Nama lengkap wakil"
                  />
                </div>
              </div>

              <div class="form-group">
                <label>Visi</label>
                <textarea
                  id="new-candidate-vision"
                  class="form-control"
                  placeholder="Tulis visi paslon"
                ></textarea>
              </div>

              <div class="form-group">
                <label>Misi</label>
                <textarea
                  id="new-candidate-mission"
                  class="form-control"
                  placeholder="Tulis misi paslon"
                ></textarea>
              </div>

              <!-- Upload Foto -->
              <div class="form-group">
                <label>ğŸ“· Foto Paslon (Opsional)</label>
                <div class="photo-upload" id="photo-upload-area">
                  <div
                    style="
                      font-size: 3rem;
                      color: var(--gray);
                      margin-bottom: 10px;
                    "
                  >
                    <i class="fas fa-camera"></i>
                  </div>
                  <p>Klik untuk upload foto paslon</p>
                  <p style="font-size: 0.9rem; color: var(--gray)">
                    Format: JPG/PNG, maks. 2MB
                  </p>
                  <input
                    type="file"
                    id="candidate-photo"
                    accept="image/*"
                    style="display: none"
                  />
                </div>
                <img
                  id="photo-preview"
                  class="photo-preview"
                  alt="Preview Foto"
                />
              </div>

              <button id="btn-add-candidate" class="btn btn-success">
                â• Tambah Paslon
              </button>
              <div
                id="add-candidate-message"
                class="alert"
                style="display: none; margin-top: 15px"
              ></div>
            </div>

            <!-- Logo Organisasi -->
            <div
              style="
                background: #f8f9fa;
                padding: 25px;
                border-radius: 15px;
                margin-bottom: 30px;
              "
            >
              <h4 style="margin-bottom: 20px">ğŸ–¼ï¸ Kelola Logo Organisasi</h4>

              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                  gap: 20px;
                "
              >
                <div class="form-group">
                  <label>ğŸ‘‘ Logo BEST</label>
                  <div class="logo-upload-area" data-org="best">
                    <div class="logo-preview" id="logo-best-preview">
                      <div style="font-size: 2rem">ğŸ‘‘</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px">
                      <button
                        class="btn btn-secondary upload-logo-btn"
                        data-org="best"
                      >
                        Upload Logo
                      </button>
                      <input
                        type="file"
                        class="logo-upload-input"
                        data-org="best"
                        accept="image/*"
                        style="display: none"
                      />
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label>âš–ï¸ Logo DPS</label>
                  <div class="logo-upload-area" data-org="dps">
                    <div class="logo-preview" id="logo-dps-preview">
                      <div style="font-size: 2rem">âš–ï¸</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px">
                      <button
                        class="btn btn-secondary upload-logo-btn"
                        data-org="dps"
                      >
                        Upload Logo
                      </button>
                      <input
                        type="file"
                        class="logo-upload-input"
                        data-org="dps"
                        accept="image/*"
                        style="display: none"
                      />
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label>â¤ï¸ Logo PMR</label>
                  <div class="logo-upload-area" data-org="pmr">
                    <div class="logo-preview" id="logo-pmr-preview">
                      <div style="font-size: 2rem">â¤ï¸</div>
                    </div>
                    <div style="text-align: center; margin-top: 10px">
                      <button
                        class="btn btn-secondary upload-logo-btn"
                        data-org="pmr"
                      >
                        Upload Logo
                      </button>
                      <input
                        type="file"
                        class="logo-upload-input"
                        data-org="pmr"
                        accept="image/*"
                        style="display: none"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Daftar Paslon -->
            <h4 style="margin: 30px 0 20px 0">ğŸ“‹ Daftar Paslon Terdaftar</h4>
            <div id="admin-candidates-list">
              <p>Memuat data paslon...</p>
            </div>
          </div>

          <!-- Bagian Data Suara -->
          <div id="admin-votes" class="admin-section">
            <h3 style="margin-bottom: 20px">ğŸ“‹ Data Suara Pemilih</h3>

            <div
              style="
                display: flex;
                gap: 15px;
                margin-bottom: 25px;
                flex-wrap: wrap;
              "
            >
              <button id="btn-refresh-votes" class="btn btn-primary">
                ğŸ”„ Refresh Data
              </button>
              <button id="btn-export-votes" class="btn btn-secondary">
                ğŸ“¥ Export Data
              </button>
              <button id="btn-reset-votes" class="btn btn-danger">
                ğŸ—‘ï¸ Reset Semua Suara
              </button>
            </div>

            <div id="votes-list">
              <p>Memuat data suara...</p>
            </div>
          </div>

          <!-- Bagian Hasil Voting - DIPERBAIKI -->
          <div id="admin-results" class="admin-section">
            <h3 style="margin-bottom: 20px">ğŸ“Š Hasil Voting Detail</h3>

            <div id="admin-results-content">
              <p>Memuat hasil voting...</p>
            </div>
          </div>

          <!-- Bagian Pengaturan -->
          <div id="admin-settings" class="admin-section">
            <h3 style="margin-bottom: 20px">âš™ï¸ Pengaturan Sistem</h3>

            <div
              style="background: #f8f9fa; padding: 25px; border-radius: 15px"
            >
              <div class="form-group">
                <label>ğŸ·ï¸ Judul Website</label>
                <div style="display: flex; gap: 10px">
                  <input
                    type="text"
                    id="website-title"
                    class="form-control"
                    value="Pemilihan Organisasi SMAN 5 Bagan Sinembah"
                    placeholder="Masukkan judul website"
                  />
                  <button
                    id="btn-save-title"
                    class="btn btn-primary"
                    style="min-width: 120px"
                  >
                    ğŸ’¾ Simpan Judul
                  </button>
                </div>
                <p
                  style="font-size: 0.9rem; color: var(--gray); margin-top: 5px"
                >
                  Judul akan tampil di tab browser dan header
                </p>
              </div>

              <div class="form-group">
                <label>ğŸ« Nama Sekolah</label>
                <input
                  type="text"
                  id="school-name"
                  class="form-control"
                  value="SMAN 5 Bagan Sinembah"
                />
              </div>

              <div class="form-group">
                <label>ğŸ›ï¸ Periode Pemilihan</label>
                <input
                  type="text"
                  id="election-period"
                  class="form-control"
                  value="2026/2027"
                />
              </div>

              <div class="form-group">
                <label>ğŸ–¼ï¸ Logo Sekolah</label>
                <input
                  type="file"
                  id="school-logo"
                  class="form-control"
                  accept="image/*"
                />
                <p
                  style="font-size: 0.9rem; color: var(--gray); margin-top: 5px"
                >
                  Upload logo sekolah untuk ditampilkan di header
                </p>
              </div>

              <div class="form-group">
                <label>ğŸ” Ubah Password Admin</label>
                <input
                  type="password"
                  id="new-password"
                  class="form-control"
                  placeholder="Password baru"
                />
                <input
                  type="password"
                  id="confirm-password"
                  class="form-control"
                  placeholder="Konfirmasi password"
                  style="margin-top: 10px"
                />
              </div>

              <div style="display: flex; gap: 15px; margin-top: 25px">
                <button id="btn-save-settings" class="btn btn-success">
                  ğŸ’¾ Simpan Pengaturan
                </button>
                <button id="btn-reset-system" class="btn btn-danger">
                  ğŸ”„ Reset Sistem
                </button>
              </div>
            </div>
          </div>

          <!-- Logout -->
          <div
            style="
              text-align: center;
              margin-top: 40px;
              padding-top: 20px;
              border-top: 1px solid #eee;
            "
          >
            <button id="btn-admin-logout" class="btn btn-secondary">
              ğŸšª Logout dari Admin
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer>
      <div class="container">
        <p>Â© 2024 Sistem Pemilihan Online SMAN 5 Bagan Sinembah</p>
        <p style="margin-top: 10px; font-size: 0.85rem">
          ğŸ“ Kontak: Panitia Pemilihan Organisasi | ğŸ“§ Email:
          panitia@sman5bagan.sch.id
        </p>
      </div>
    </footer>

    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-spinner">
        <div class="spinner-circle"></div>
        <div class="spinner-inner"></div>
      </div>
      <div class="loading-bar">
        <div class="loading-bar-fill"></div>
      </div>
      <div class="loading-text">
        <div class="loading-text-main">Memproses...</div>
        <div class="loading-text-sub">Mohon tunggu sebentar</div>
      </div>
    </div>
    <script src="assets/js/script.js"></script>
  </body>
</html>
